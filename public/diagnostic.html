<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineFlix - Diagnostic Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .status-box {
            background: #2a2a2a;
            border: 2px solid #444;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .status-good { border-color: #00ff00; }
        .status-bad { border-color: #ff0000; }
        .status-warning { border-color: #ffaa00; }
        h1 { color: #e50914; }
        h2 { color: #fff; margin-top: 0; }
        pre {
            background: #000;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .button {
            background: #e50914;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover { background: #c50812; }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffaa00; }
    </style>
</head>
<body>
    <h1>üîç CineFlix Diagnostic Page</h1>
    <p>This page will help diagnose why your site shows a white page.</p>

    <div class="status-box status-warning">
        <h2>‚ö†Ô∏è Important Notice</h2>
        <p><strong>If you see "Environment Variables Missing" below:</strong></p>
        <ol>
            <li>Go to <a href="https://vercel.com/dashboard" target="_blank" style="color: #00aaff;">Vercel Dashboard</a></li>
            <li>Click your <strong>cineflix</strong> project</li>
            <li>Go to <strong>Settings ‚Üí Environment Variables</strong></li>
            <li>Add the 3 required variables (shown below)</li>
            <li>Go to <strong>Deployments ‚Üí Redeploy</strong></li>
            <li>Wait 1-2 minutes, then refresh this page</li>
        </ol>
    </div>

    <div id="status-container"></div>

    <div class="status-box">
        <h2>Manual Tests</h2>
        <button class="button" onclick="testAPI()">Test TMDB API</button>
        <button class="button" onclick="checkEnvVars()">Check Environment Variables</button>
        <button class="button" onclick="window.location.href='/'">Go to Main Site</button>
    </div>

    <script type="module">
        const statusContainer = document.getElementById('status-container');

        function addStatus(title, message, status, details = '') {
            const box = document.createElement('div');
            box.className = `status-box status-${status}`;
            box.innerHTML = `
                <h2>${title}</h2>
                <p>${message}</p>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            statusContainer.appendChild(box);
        }

        // Check if running in browser
        addStatus(
            '‚úì Browser Check',
            'JavaScript is running successfully',
            'good'
        );

        // Check environment variables
        const apiKey = import.meta.env.VITE_TMDB_API_KEY;
        const baseUrl = import.meta.env.VITE_TMDB_BASE_URL;
        const imageUrl = import.meta.env.VITE_TMDB_IMAGE_BASE_URL;

        if (apiKey) {
            addStatus(
                '‚úì Environment Variables Found',
                'TMDB API key is configured',
                'good',
                `API Key: ${apiKey.substring(0, 10)}...
Base URL: ${baseUrl}
Image URL: ${imageUrl}`
            );
        } else {
            addStatus(
                '‚úó Environment Variables Missing',
                'TMDB API key is NOT configured. This is why you see a white page!',
                'bad',
                `VITE_TMDB_API_KEY: ${apiKey === undefined ? 'undefined' : 'empty'}
VITE_TMDB_BASE_URL: ${baseUrl || 'undefined'}
VITE_TMDB_IMAGE_BASE_URL: ${imageUrl || 'undefined'}

FIX: Add environment variables in Vercel Dashboard:
1. Go to vercel.com/dashboard
2. Click Settings ‚Üí Environment Variables
3. Add VITE_TMDB_API_KEY with your TMDB API key
4. Add VITE_TMDB_BASE_URL = https://api.themoviedb.org/3
5. Add VITE_TMDB_IMAGE_BASE_URL = https://image.tmdb.org/t/p
6. Click Deployments ‚Üí Redeploy`
            );
        }

        // Test API connection
        window.testAPI = async function() {
            if (!apiKey) {
                addStatus(
                    '‚úó Cannot Test API',
                    'TMDB API key is missing! Add environment variables first.',
                    'bad',
                    `You need to:
1. Go to Vercel Dashboard (https://vercel.com/dashboard)
2. Click Settings ‚Üí Environment Variables
3. Add VITE_TMDB_API_KEY with your TMDB API key
4. Add VITE_TMDB_BASE_URL = https://api.themoviedb.org/3
5. Add VITE_TMDB_IMAGE_BASE_URL = https://image.tmdb.org/t/p
6. Click Deployments ‚Üí Redeploy
7. Wait 1-2 minutes and refresh this page

Get TMDB API Key: https://www.themoviedb.org/settings/api`
                );
                return;
            }

            const testUrl = `${baseUrl || 'https://api.themoviedb.org/3'}/movie/popular?api_key=${apiKey}`;
            
            addStatus(
                'üîÑ Testing API...',
                'Attempting to fetch data from TMDB',
                'warning',
                `Testing URL: ${testUrl.replace(apiKey, apiKey.substring(0, 10) + '...')}`
            );

            try {
                const response = await fetch(testUrl);
                const data = await response.json();
                
                if (response.ok) {
                    addStatus(
                        '‚úì API Test Success',
                        `Successfully fetched ${data.results?.length || 0} movies from TMDB!`,
                        'good',
                        `First movie: "${data.results?.[0]?.title || 'No data'}"
Total movies fetched: ${data.results?.length || 0}
Your TMDB API is working correctly!`
                    );
                } else {
                    addStatus(
                        '‚úó API Test Failed',
                        `HTTP ${response.status}: ${data.status_message || 'Unknown error'}`,
                        'bad',
                        `Error Details:
${JSON.stringify(data, null, 2)}

Common causes:
- Invalid API key
- API key not activated yet
- Rate limit exceeded
- Network issue`
                    );
                }
            } catch (error) {
                addStatus(
                    '‚úó API Test Failed',
                    'Network error or API unreachable',
                    'bad',
                    `Error: ${error.message}

Possible causes:
- No internet connection
- TMDB API is down
- CORS issue
- Browser blocking request`
                );
            }
        };

        window.checkEnvVars = function() {
            const allEnvVars = import.meta.env;
            addStatus(
                'All Environment Variables',
                'Complete list of available environment variables',
                'warning',
                JSON.stringify(allEnvVars, null, 2)
            );
        };

        // Auto-test API if key exists
        if (apiKey) {
            window.testAPI();
        }

        // Check if main app loads
        try {
            const mainScript = document.querySelector('script[src*="main"]');
            if (mainScript) {
                addStatus(
                    '‚úì Main Script Found',
                    'Main application script is loading',
                    'good'
                );
            }
        } catch (e) {
            addStatus(
                '‚ö† Script Check',
                'Could not verify main script',
                'warning',
                e.message
            );
        }

        // Summary
        if (!apiKey) {
            addStatus(
                'üìã Summary',
                'Your site shows white page because environment variables are missing.',
                'bad',
                `SOLUTION:
1. Go to https://vercel.com/dashboard
2. Click your 'cineflix' project
3. Go to Settings ‚Üí Environment Variables
4. Add these three variables:
   - VITE_TMDB_API_KEY = [your TMDB API key]
   - VITE_TMDB_BASE_URL = https://api.themoviedb.org/3
   - VITE_TMDB_IMAGE_BASE_URL = https://image.tmdb.org/t/p
5. Go to Deployments tab
6. Click (...) ‚Üí Redeploy
7. Wait 1-2 minutes
8. Your site will work!

Get TMDB API Key: https://www.themoviedb.org/settings/api`
            );
        } else {
            addStatus(
                'üìã Summary',
                'Environment variables are configured. If site still doesn\'t work, check console for errors.',
                'good',
                'Open DevTools (F12) ‚Üí Console tab to see any JavaScript errors'
            );
        }
    </script>
</body>
</html>
